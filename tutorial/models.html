<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using Models &mdash; Effective Django</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Effective Django" href="../index.html" />
    <link rel="up" title="Effective Django Tutorial" href="index.html" />
    <link rel="next" title="Writing Views" href="views.html" />
    <link rel="prev" title="Getting Started" href="getting-started.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-188298-7']);
  _gaq.push(['_trackPageview']);
</script>

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="views.html" title="Writing Views"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="getting-started.html" title="Getting Started"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Effective Django</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Effective Django Tutorial</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-models">
<h1>Using Models<a class="headerlink" href="#using-models" title="Permalink to this headline">¶</a><a class="headerlink" href=".././slides/tutorial/models.html#using-models" title="Slides">§</a></h1>
<span class="admonition-django-models"></span><div class="section" id="configuring-the-database">
<h2>Configuring the Database<a class="headerlink" href="#configuring-the-database" title="Permalink to this headline">¶</a><a class="headerlink" href=".././slides/tutorial/models.html#configuring-the-database" title="Slides">§</a></h2>
<span class="admonition-configuring-databases"></span><p>Django includes support out of the box for MySQL, PostgreSQL, SQLite3,
and Oracle. <a class="reference external" href="http://docs.python.org/2/library/sqlite3.html">SQLite3</a> is included with Python starting with version
2.5, so we&#8217;ll use it for our project for simplicity. If you were going
to use MySQL, for example, you&#8217;d need to add <a class="reference external" href="https://pypi.python.org/pypi/MySQL-python">mysql-python</a> to your
<code class="docutils literal"><span class="pre">requirements.txt</span></code> file.</p>
<p>To enable SQLite as the database, edit the <code class="docutils literal"><span class="pre">DATABASES</span></code> definition in
<code class="docutils literal"><span class="pre">addressbook/settings.py</span></code>. The <code class="docutils literal"><span class="pre">settings.py</span></code> file contains the
Django configuration for our project. There are some settings that you
must specify &#8211; like the <code class="docutils literal"><span class="pre">DATABASES</span></code> configuration &#8211; and others
that are optional. Django fills in some defaults when it generates the
project scaffolding, and the documentation contains a <a class="reference external" href="https://docs.djangoproject.com/en/1.5/ref/settings/">full list of
settings</a>. You can also add your own settings here, if needed.</p>
<p>For SQLite we need to set the engine and then give it a name. The
SQLite backend uses the <code class="docutils literal"><span class="pre">NAME</span></code> as the filename for the database.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>  <span class="c"># &#39;postgresql_psycopg2&#39;, &#39;mysql&#39;, &#39;sqlite3&#39; or &#39;oracle&#39;.</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;address.db&#39;</span><span class="p">,</span>
        <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>                      <span class="c"># Not used with sqlite3.</span>
        <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>                  <span class="c"># Not used with sqlite3.</span>
        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>                      <span class="c"># Set to empty string for localhost. Not used with sqlite3.</span>
        <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>                      <span class="c"># Set to empty string for default. Not used with sqlite3.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the database engine is specified as a string, and not a
direct reference to the Python object. This is because the settings
file needs to be easily importable, without triggering any side
effects. You should avoid adding imports to the settings file.</p>
<p>You rarely need to import the settings file directly; Django imports
it for you, and makes it available as <code class="docutils literal"><span class="pre">django.conf.settings</span></code>. You
typically import your settings from <code class="docutils literal"><span class="pre">django.conf</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-model">
<h2>Creating a Model<a class="headerlink" href="#creating-a-model" title="Permalink to this headline">¶</a><a class="headerlink" href=".././slides/tutorial/models.html#creating-a-model" title="Slides">§</a></h2>
<span class="admonition-defining-models"></span><p>Django models map (roughly) to a database table, and provide a place
to encapsulate business logic. All models subclass the base <a class="reference external" href="https://docs.djangoproject.com/en/1.5/ref/models/instances/#django.db.models.Model">Model</a>
class, and contain field definitions. Let&#8217;s start by creating a simple
Contact model for our application in <code class="docutils literal"><span class="pre">contacts/models.py</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Contact</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>

    <span class="p">)</span>

    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span>
        <span class="p">])</span>
</pre></div>
</div>
<p>Django provides a set of <a class="reference external" href="https://docs.djangoproject.com/en/1.5/ref/models/fields/">fields</a> that map to data types and different
validation rules. For example, the <code class="docutils literal"><span class="pre">EmailField</span></code> here maps to the
same column type as the <code class="docutils literal"><span class="pre">CharField</span></code>, but adds validation for the
data.</p>
<p>Once you&#8217;ve created a model, you need to update your database with the
new tables. Django&#8217;s <code class="docutils literal"><span class="pre">syncdb</span></code> command looks for models that are
installed and creates tables for them if needed.</p>
<div class="highlight-python"><div class="highlight"><pre>(tutorial)$ python ./manage.py syncdb

Creating tables ...
Creating table auth_permission
Creating table auth_group_permissions
Creating table auth_group
Creating table auth_user_user_permissions
Creating table auth_user_groups
Creating table auth_user
Creating table django_content_type
Creating table django_session
Creating table django_site

...
</pre></div>
</div>
<p>Our contact table isn&#8217;t anywhere to be seen. The reason is that we
need to tell the Project to use the Application.</p>
<p>The <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> setting lists the applications that the project
uses. These are listed as strings that map to Python packages. Django
will import each and looks for a <code class="docutils literal"><span class="pre">models</span></code> module there. Add our
Contacts app to the project&#8217;s <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> setting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="c"># &#39;django.contrib.admin&#39;,</span>
    <span class="c"># Uncomment the next line to enable admin documentation:</span>
    <span class="c"># &#39;django.contrib.admindocs&#39;,</span>
    <span class="s">&#39;contacts&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then run <code class="docutils literal"><span class="pre">syncdb</span></code> again:</p>
<div class="highlight-python"><div class="highlight"><pre>(tutorial)$ python ./manage.py syncdb
Creating tables ...
Creating table contacts_contact
Installing custom SQL ...
Installing indexes ...
Installed 0 object(s) from 0 fixture(s)
</pre></div>
</div>
<p>Note that Django created a table named <code class="docutils literal"><span class="pre">contacts_contact</span></code>: by
default Django will name your tables using a combination of the
application name and model name. You can override that with the
<a class="reference external" href="https://docs.djangoproject.com/en/1.5/ref/models/options/">model Meta</a> options.</p>
</div>
<div class="section" id="interacting-with-the-model">
<h2>Interacting with the Model<a class="headerlink" href="#interacting-with-the-model" title="Permalink to this headline">¶</a><a class="headerlink" href=".././slides/tutorial/models.html#interacting-with-the-model" title="Slides">§</a></h2>
<span class="admonition-instantiating-models"></span><p>Now that the model has been synced to the database we can interact
with it using the interactive shell.</p>
<div class="highlight-python"><div class="highlight"><pre>(tutorial)$ python ./manage.py shell
Python 2.7.3 (default, Aug  9 2012, 17:23:57)
[GCC 4.7.1 20120720 (Red Hat 4.7.1-5)] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
(InteractiveConsole)
&gt;&gt;&gt; from contacts.models import Contact
&gt;&gt;&gt; Contact.objects.all()
[]
&gt;&gt;&gt; Contact.objects.create(first_name=&#39;Nathan&#39;, last_name=&#39;Yergler&#39;)
&lt;Contact: Nathan Yergler&gt;
&gt;&gt;&gt; Contact.objects.all()
[&lt;Contact: Nathan Yergler&gt;]
&gt;&gt;&gt; nathan = Contact.objects.get(first_name=&#39;Nathan&#39;)
&gt;&gt;&gt; nathan
&lt;Contact: Nathan Yergler&gt;
&gt;&gt;&gt; print nathan
Nathan Yergler
&gt;&gt;&gt; nathan.id
1
</pre></div>
</div>
<p>There are a few new things here. First, the <code class="docutils literal"><span class="pre">manage.py</span> <span class="pre">shell</span></code>
command gives us a interactive shell with the Python path set up
correctly for Django. If you try to run Python and just import your
application, an Exception will be raised because Django doesn&#8217;t know
which <code class="docutils literal"><span class="pre">settings</span></code> to use, and therefore can&#8217;t map Model instances to
the database.</p>
<p>Second, there&#8217;s this <code class="docutils literal"><span class="pre">objects</span></code> property on our model class. That&#8217;s
the model&#8217;s <a class="reference external" href="https://docs.djangoproject.com/en/1.5/topics/db/managers/">Manager</a>. If a single instance of a Model is analogous to
a row in the database, the Manager is analogous to the table. The
default model manager provides querying functionality, and can be
customized. When we call <code class="docutils literal"><span class="pre">all()</span></code> or <code class="docutils literal"><span class="pre">filter()</span></code> or the Manager, a
QuerySet is returned. A QuerySet is iterable, and loads data from the
database as needed.</p>
<p>Finally, there&#8217;s this <code class="docutils literal"><span class="pre">id</span></code> field that we didn&#8217;t define. Django adds
an <code class="docutils literal"><span class="pre">id</span></code> field as the primary key for your model, unless you <a class="reference external" href="https://docs.djangoproject.com/en/1.5/topics/db/models/#automatic-primary-key-fields">specify
a primary key</a>.</p>
<span class="admonition-model-managers"></span><span class="admonition-querying-with-managers"></span></div>
<div class="section" id="writing-a-test">
<h2>Writing a Test<a class="headerlink" href="#writing-a-test" title="Permalink to this headline">¶</a><a class="headerlink" href=".././slides/tutorial/models.html#writing-a-test" title="Slides">§</a></h2>
<span class="admonition-testing-models"></span><p>We have one method defined on our model, <code class="docutils literal"><span class="pre">__str__</span></code>, and this is a
good time to start writing tests. The <code class="docutils literal"><span class="pre">__str__</span></code> method of a model
will get used in quite a few places, and it&#8217;s entirely conceivable
it&#8217;d be exposed to end users. It&#8217;s worth writing a test so we
understand how we expect it to operate. Django creates a <code class="docutils literal"><span class="pre">tests.py</span></code>
file when it creates the application, so we&#8217;ll add our first test to
that file in the contacts app.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contacts.models</span> <span class="kn">import</span> <span class="n">Contact</span>
<span class="o">...</span>
<span class="k">class</span> <span class="nc">ContactTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Contact model tests.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">contact</span> <span class="o">=</span> <span class="n">Contact</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s">&#39;John&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s">&#39;Smith&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">contact</span><span class="p">),</span>
            <span class="s">&#39;John Smith&#39;</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
<span class="admonition-running-the-tests"></span><p>You can run the tests for your application using <code class="docutils literal"><span class="pre">manage.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>(tutorial)$ python manage.py test
</pre></div>
</div>
<p>If you run this now, you&#8217;ll see that around 420 tests run. That&#8217;s
surprising, since we&#8217;ve only written one. That&#8217;s because by default
Django runs the tests for all installed applications. When we added
the <code class="docutils literal"><span class="pre">contacts</span></code> app to our project, there were several Django apps
there by default. The extra 419 tests come from those.</p>
<p>If you want to run the tests for a specific app, just specify the app
name on the command line:</p>
<div class="highlight-python"><div class="highlight"><pre>(tutorial)$ python manage.py test contacts
Creating test database for alias &#39;default&#39;...
..
----------------------------------------------------------------------
Ran 2 tests in 0.000s

OK
Destroying test database for alias &#39;default&#39;...
$
</pre></div>
</div>
<p>One other interesting thing to note before moving on is the first and
last line of output: &#8220;Creating test database&#8221; and &#8220;Destroying test
database&#8221;. Some tests need access to a database, and because we don&#8217;t
want to mingle test data with &#8220;real&#8221; data (for a variety of reasons,
not the least of which is determinism), Django helpfully creates a
test database for us before running the tests. Essentially it creates
a new database, and runs <code class="docutils literal"><span class="pre">syncdb</span></code> on it. If you subclass from
Django&#8217;s <code class="docutils literal"><span class="pre">TestCase</span></code> (which we are), Django also resets any default
data after running each TestCase, so that changes in one test won&#8217;t
break or influence another.</p>
</div>
<div class="include-as-slide slide-level-2 section" id="review">
<h2>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a><a class="headerlink" href=".././slides/tutorial/models.html#review" title="Slides">§</a></h2>
<ul class="simple">
<li>Models define the fields in a table, and can contain business logic.</li>
<li>The <code class="docutils literal"><span class="pre">syncdb</span></code> manage command creates the tables in your database from
models</li>
<li>The model Manager allows you to operate on the collection of
instances: querying, creating, etc.</li>
<li>Write unit tests for methods you add to the model</li>
<li>The <code class="docutils literal"><span class="pre">test</span></code> manage command runs the unit tests</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using Models</a><ul>
<li><a class="reference internal" href="#configuring-the-database">Configuring the Database</a></li>
<li><a class="reference internal" href="#creating-a-model">Creating a Model</a></li>
<li><a class="reference internal" href="#interacting-with-the-model">Interacting with the Model</a></li>
<li><a class="reference internal" href="#writing-a-test">Writing a Test</a></li>
<li><a class="reference internal" href="#review">Review</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="getting-started.html"
                        title="previous chapter">Getting Started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="views.html"
                        title="next chapter">Writing Views</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorial/models.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
  <h3>Slides</h3>
  <ul class="this-page-menu">
    <li><a href="../.././slides/tutorial/models.html"
           rel="nofollow">View as slides</a></li>
  </ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="views.html" title="Writing Views"
             >next</a></li>
        <li class="right" >
          <a href="getting-started.html" title="Getting Started"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Effective Django</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Effective Django Tutorial</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2012-2013, Nathan Yergler.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>

  </body>
</html>